<div class="explore-container fade-in" *ngIf="vm$ | async as vm">
    <div class="header">
        <h1>Explore the World</h1>

        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search for a country..." [ngModel]="searchQuery"
                (ngModelChange)="onSearchChange($event)">
        </div>
    </div>

    <!-- Main Content: Sidebar + Countries -->
    <div class="content-layout">
        <!-- Continent Filter Sidebar -->
        <app-continent-filter [continents]="vm.continents" [continentCounts]="vm.continentCounts"
            [selectedContinents]="vm.selectedContinents" [totalCount]="vm.totalCountries"
            (continentToggled)="toggleContinent($event)" (filterCleared)="clearFilter()">
        </app-continent-filter>

        <!-- Countries Section -->
        <main class="countries-section">
            @for (group of vm.countryGroups; track group.continent) {
            <div class="continent-section">
                <h2 class="continent-header">{{ group.continent }}</h2>
                <div class="grid">
                    @for (country of group.countries; track country.id) {
                    <div class="country-card">
                        <div class="country-card-header">
                            <div class="country-info">
                                <a [routerLink]="['/explore', country.id]" class="country-name-link">
                                    <h3 class="country-name">{{ country.name }}</h3>
                                </a>
                                <div class="country-meta">
                                    <span class="country-id">{{ country.id }}</span>
                                </div>
                            </div>
                            <button class="btn-visit" [class.visited]="isCountryVisited(country.id, vm.profile)"
                                (click)="toggleCountryVisited(country.id, vm.profile)">
                                {{ isCountryVisited(country.id, vm.profile) ? 'Visited' : 'Add to List' }}
                            </button>
                        </div>

                        <div class="country-body">
                            <p class="country-subinfo">{{ country.region }} - {{ country.native }}</p>
                        </div>
                    </div>
                    }
                </div>
            </div>
            }
        </main>
    </div>
</div>